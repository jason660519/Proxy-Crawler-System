# 第三階段前端改善細部計畫報告\_第一集

## 1. 目標與範圍

- 目標：提升首頁五區（Header / Activity Bar / Side Panel / Main Content / Status Bar）的資訊密度、互動性、可觀測性；導入標準化 API 層與環境變數，為資料驅動 UI 奠基。
- 範圍：前端 `frontend/src` 全域 UI 與首頁 `Dashboard`，不含帳號系統與深層管理頁。

## 2. 現況摘要

- 五區版型已完成，但資訊偏靜態、資料以 mock 為主。
- 已加入 `src/services/http.ts`、`src/services/api.ts`，支援 `VITE_API_BASE_URL`（預設 `http://localhost:8000`）。
- 後端健康端點可用：`/health`、`/etl/health`；資料型內容（代理清單、任務、統計）尚未對接。

## 3. 改善主軸

- 資料驅動：首頁卡片、表格、列表改為 API 驅動，保留優雅降級。
- 可觀測性：健康、佇列、日誌、效能趨勢即時可視化。
- 互動效率：快速搜尋/篩選、常用動作入口、狀態提示與回饋。
- 性能/體驗：分頁、虛擬滾動、快取、錯誤/重試機制。

## 4. 工作項目（依區塊）

### 4.1 Header（2 人日）

- 搜尋列（代理/IP/國家/任務）
- 快速動作：新增任務、批次驗證、同步來源
- 通知鈴鐺（錯誤/告警聚合）、主題/語言切換
- 驗收：可輸入查詢事件（mock）、動作按鈕出現與 Modal 占位、通知徽章顯示

### 4.2 Activity Bar（1.5 人日）

- 圖標：Dashboard / Proxies / ETL / Monitoring / Settings
- 任務佇列圖標（排隊/執行中）與連線狀態點（API/Redis/Postgres 匯總）
- 驗收：圖標高亮與路由同步；狀態點隨 `/health`/`/etl/health` 變化

### 4.3 Side Panel（3 人日）

- 快速篩選器：協議、國家、匿名等級、速度區間、狀態
- Saved Views（保存/套用查詢，localStorage）
- 最近任務/最近變更（列表）
- 驗收：篩選事件影響主表格參數（先本地過濾、預留 API）

### 4.4 Main Content（4 人日）

- 健康狀態卡片（主 API / ETL / Redis / Postgres）
- 趨勢圖（成功率、驗證量、平均延遲；先假資料）
- 任務佇列板（排隊/執行/完成/失敗；重試/取消按鈕占位）
- 即時日誌（10s 輪詢，暫停/繼續、關鍵字高亮）
- 驗收：健康卡片反映 `/health`、`/etl/health`；趨勢圖 3 張渲染；任務板分組；日誌輪詢可控

### 4.5 Status Bar（1 人日）

- 連線狀態、當前視圖統計、版本/環境/延遲、背景作業與錯誤數
- 驗收：顯示 `environment`、版本、最近一次 `/health` 耗時；顯示列表統計（顯示數/總數）

## 5. API 對接與資料注意事項

- 一律由前端透過 API 層呼叫，禁止直連 DB。
- 分頁/排序/篩選需伺服端支援（避免全量抓取）。
- 輪詢加指數回退與中止控制；後續升級 WebSocket/SSE。
- 熱資料後端 Redis 快取（TTL 30~120s）。
- 大批量操作走背景任務，前端展示任務狀態。
- 寫入需冪等，採用樂觀鎖或 `updated_at` 欄位。

建議端點（提案）

- GET `/proxies?status=&protocol=&country=&page=&size=`
- GET `/metrics/summary`
- GET `/tasks?status=&page=&size=`
- GET `/logs?source=&since=&limit=`
- POST `/tasks/{id}/retry`、POST `/tasks/{id}/cancel`

索引建議（DB）

- `proxies(status, protocol, country, last_checked)`
- `tasks(status, created_at)`
- `logs(source, timestamp)`

## 6. 技術落地與規範

- `src/services/http.ts`：統一 axios 實例（讀 `VITE_API_BASE_URL`）
- `src/services/api.ts`：集中 API 封裝（Typing 完整）
- 組件拆分：`components/dashboard/*`、`components/status/*`
- 型別：`types/metrics.ts`、`types/tasks.ts`、`types/proxies.ts`
- 狀態：本地 state + hooks，視需引入 store
- 錯誤/重試：全域攔截器 + 統一通知

## 7. 任務拆單與分配建議

- FE-1（UI/交互）：Header、Activity Bar、Status Bar
- FE-2（資料/圖表）：Main Content（趨勢圖、任務板、日誌）
- FE-3（過濾/快取）：Side Panel、Saved Views、列表串接
- FE-Infra（橫向）：API 封裝、型別、錯誤/重試、測試示範

## 8. 驗收清單（摘要）

- Header 搜尋/快捷動作可用（mock）
- Activity Bar 狀態點依健康端點變化
- Side Panel 篩選影響主列表（本地過濾先行）
- Main Content 四區塊渲染與輪詢（mock+健康端點）
- Status Bar 顯示環境、延遲、統計
- API 層與型別齊備，`.env` 可切換後端位址

## 9. 時程與里程碑（約 2 週，3 人）

- W1：UI/骨架/假資料；API 層完成；健康端點接上
- W2：列表/篩選/日誌/任務板；體驗優化與驗收

## 10. 風險與緩解

- 後端缺端點 → 先 mock，協議先行；預留轉接層
- 大量資料性能 → 分頁+虛擬滾動；逐步引入伺服端分頁
- 輪詢過頻 → 回退/節流；升級 WebSocket/SSE
- 權限/安全 → 先封裝，待帳號系統導入再分級

## 11. 執行說明

- 前端 `.env`：`VITE_API_BASE_URL=http://localhost:8000`
- 啟動：`npm ci && npm run dev -- --host`
- 後端（Docker）：`docker compose -f JasonSpider/docker-compose.yml up -d --build`

---

附錄：下一集預告

- 第二集將涵蓋 Proxies/ETL/Monitoring 各頁的資訊架構與 API 契約。
